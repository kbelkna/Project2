---
title: "Wine Data API Vignette"
author: "Annie Brinza"
date: '2022-10-07'
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(httr)
library(tidyverse)
library(jsonlite)
```

This document is a vignette about contacting an API using functions we've created to
query, parse, and return well-structured data. Weâ€™ll then use our functions to obtain data from the API
and do some exploratory data analysis. Kara Belknap and Annie Brinza worked on this project. We decided to use wine data from the food data API. Specifically, we will be focusing on general wine recommendations, dish pairings to go with a certain wine, and wine recommendations given a certain dish. We will be building functions to accomplish all of that.

To interact with these functions, either a general wine type such as "merlot" needs to be given, or a dish or cuisine type such as "Italian." This will be detailed further for each of the API calls.

## Requirements
WILL FILL OUT LATER


## API Interaction Functions
In this section, we will define functions to interact with the various wine APIs found [here](https://spoonacular.com/food-api/docs#Wine-Guide).
We will be pulling from three different APIs: [Wine Recommendation](https://spoonacular.com/food-api/docs#Wine-Recommendation), 
[Wine Pairing](https://spoonacular.com/food-api/docs#Wine-Pairing), and 
[Dish Pairing for Wine](https://spoonacular.com/food-api/docs#Dish-Pairing-for-Wine). 

The APIs do require an API key to access, which can be received by signing up for a free account. For the free plan, the rate limit is 60 requests in one minute, and a total of 150 requests per day.

### Wine Recommendation Function

### Wine Pairing Function
This function will interaction with the [Wine Pairing API](https://spoonacular.com/food-api/docs#Wine-Pairing).
The user will need to input `food`, which can be a certain dish such as `steak`, or a cuisine such as `Italian`.
These inputs should be simple - a full recipe name does not need to be given.
A dataframe will be returned that has the paired wine recommendations. These 
recommendations can then be used in combination with the Wine Recommendation Function to find the exact wine bottle desired.

```{r wine_pairing}
get_wine_pairings <- function(food, max_price = NULL){
  # API key generated by us
  api_key <- "e48e5e643093487fbc7447a17bb3d113"
  
  # Checking if the food is a valid input
  if(is.character(food)){
      API_string <- paste0("https://api.spoonacular.com/food/wine/pairing?apiKey=",
                       api_key,"&food=",food)
  } else if(is.null(food)){
    message <- "ERROR - please enter a type of dish or cuisine"
    stop(message)
  } else if(!is.character(food)){
    message <- "ERROR - please enter a string for the type of dish or cuisine desired"
    stop(message)
  }
  # Calling the API using the created call
  output_API <- fromJSON(
    API_string
  )
  # Checking to see if the API call failed and returning error message if so
  if(output_API$status == "failure"){
    message <- paste0(output_API$message, ". Check for typos or try a simpler query")
    stop(message)
  }
  
  # Creating dataframe of wine pairings
  wine_pairings <- as.data.frame(output_API$pairedWines)
  colnames(wine_pairings) <- "wine_types"
  
  # Returning the wine pairings
  return(wine_pairings)
}

```

### Dish Pairing for Wine
This function will interact with the [Dish Pairing API](https://spoonacular.com/food-api/docs#Dish-Pairing-for-Wine).
The user will need to input a `wine` they would like a dish recommendation for, such as `merlot`.
The API will return a list of suggested dishes to go with the wine, such as `burger`.

```{r dish_pairing}
get_dish_pairings <- function(wine){
  # API key generated by us
  api_key <- "e48e5e643093487fbc7447a17bb3d113"
  
  # Checking if the wine is a valid input
  if(is.character(wine)){
      API_string <- paste0("https://api.spoonacular.com/food/wine/dishes?apiKey=",
                       api_key,"&wine=",wine)
  } else if(is.null(wine)){
    message <- "ERROR - please enter a type of wine"
    stop(message)
  } else if(!is.character(wine)){
    message <- "ERROR - please enter a string for the type of wine that needs pairing"
    stop(message)
  }
  # Calling the API using the created call
  output_API <- fromJSON(
    API_string
  )
  # Checking to see if the API call failed and returning error message if so
  if(length(output_API$status) > 0){
    message <- paste0(output_API$message, ". Check for typos or try a simpler query.")
    stop(message)
  }
  
  # Creating dataframe of dish recommendations
  dish_recommendations <- as.data.frame(output_API$pairings)
  colnames(dish_recommendations) <- "dishes"
  
  # Returning the dish recommendations
  return(dish_recommendations)
}
```


## Exploratory Data Analysis